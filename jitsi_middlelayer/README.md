# Mock Switch API Server

This is a mock server that simulates the Switch API for testing the Jitsi Meet integration with Switch authentication.

## Features

- Token-based authentication
- User profile retrieval endpoint
- Random user generation with different roles (user, moderator, admin)
- Test endpoints for creating and managing mock users

## Setup

1. Install the required dependencies:

```bash
pip install -r requirements.txt
```

2. Run the server:

```bash
python main.py
```

By default, the server runs on `http://localhost:8000`.

## API Endpoints

### Authentication

- **POST /auth/token** - Get a JWT token
  - Request Body: `{"username": "string", "role": "user|moderator|admin"}`
  - Response: `{"access_token": "string", "token_type": "bearer"}`

### User Profile

- **GET /user-service/api/user** - Get the profile of the authenticated user
  - Headers: `Authorization: Bearer {token}` or `Authtoken: {token}`
  - Response: User profile object

### Test Endpoints

- **GET /generate/{role}** - Generate a user with a specific role and return their token
  - Path Parameter: `role` (user, moderator, admin)
  - Response: Object containing token, user profile, and usage instructions

- **GET /users** - List all users in the mock database
  - Response: Dictionary of user profiles keyed by user ID

- **DELETE /users/{user_id}** - Delete a user from the mock database
  - Path Parameter: `user_id`
  - Response: Success message

## Integration with Jitsi Meet

### Setting the Auth Token

You can use the token generated by this mock server as the `authToken` in the Jitsi Meeting component:

```javascript
// React Native
<JitsiMeeting
  authToken="YOUR_MOCK_TOKEN_HERE"
  // other props...
/>

// Or using the ref method
jitsiRef.current.setAuthToken("YOUR_MOCK_TOKEN_HERE");
```

### Testing Different User Roles

1. Generate a user with a specific role by visiting:
   - For user: `http://localhost:8000/generate/user`
   - For moderator: `http://localhost:8000/generate/moderator`
   - For admin: `http://localhost:8000/generate/admin`

2. Copy the token from the response and use it as the `authToken`

3. The user's profile, including their `userId`, will be automatically retrieved by the Jitsi Meet app when the token is provided

## User Profile Structure

```json
{
  "id": 1234,                           // User ID (used as userId in Jitsi)
  "email": "username@example.com",
  "name": "Full Name",
  "firstName": "First",
  "lastName": "Last",
  "displayName": "Display Name",
  "imageurl": "https://example.com/avatar.jpg",
  "avatarUrl": "https://example.com/avatar.jpg",
  "role": "user",                       // user, moderator, or admin
  "permissions": ["permission1"],
  "user_name": "username",
  "is_bot": false,
  "active": true
}
```

## Notes

- This is a development and testing tool only
- The server uses an in-memory database which is reset when the server is restarted
- All tokens are valid for 30 minutes by default (tokens generated via `/generate/{role}` are valid for 24 hours)
- The mock server simulates the behavior of the real Switch API but does not require actual authentication credentials 